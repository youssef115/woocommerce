'use strict';(function(b,a){var d=b("body");if(0<b("#page-builder.themify_write_panel").length)themifyBuilder.is_gutenberg_editor=!1,d[0].classList.remove("themify-gutenberg-editor");else if(!themifyBuilder.is_gutenberg_editor)return;var g=a.redirectFrontend=!1,m=function(){var c=a.toolbar.$el,e=function(){var a,f=b("#page-builder"),e=b("#tb_row_wrapper"),d,g=b("#wpadminbar"),k,h=function(){var b=window.pageYOffset;a=b>=k&&b<d+e.height();!0===a?c[0].classList.add("tb_toolbar_fixed"):c[0].classList.remove("tb_toolbar_fixed")},
l=function(){var a=g.outerHeight(!0);d=Math.round(c.offset().top);k=d-a;c.css({width:f.width()+"px",left:f.offset().left,top:a})};l();window.addEventListener("scroll",h,{passive:!0});b(window).on("tfsmartresize.tfsticky",function(){l();h()});h()};if(c.is(":visible"))e();else b(".themify-meta-box-tabs a").on("click",function f(){"page-buildert"===this.id&&(e(),b(".themify-meta-box-tabs a").off("click",f))})};a.toolbarCallback=function(){a.undoManager.btnUndo=a.toolbar.el.getElementsByClassName("tb_undo_btn")[0];
a.undoManager.btnRedo=a.toolbar.el.getElementsByClassName("tb_redo_btn")[0];a.undoManager.compactBtn=a.toolbar.el.getElementsByClassName("tb_compact_undo")[0]};a.render=function(){if(!themifyBuilder.is_gutenberg_editor||document.getElementById("tb_canvas_block")){d[0].insertAdjacentHTML("afterbegin",'<div class="tb_fixed_scroll" id="tb_fixed_bottom_scroll"></div>');d.append(b("<div/>",{id:"tb_alert"}));0===themifyBuilder.builder_data.length&&(themifyBuilder.builder_data={});if(themifyBuilder.is_gutenberg_editor){var c=
wp.template("builder_admin_canvas_block");document.getElementById("tb_canvas_block").innerHTML=c()}ThemifyBuilderCommon.setToolbar();a.toolbar=new a.Views.Toolbar({el:"#tb_toolbar"});a.toolbar.render();a.toolbarCallback();a.Instances.Builder[0]=new a.Views.Builder({el:"#tb_row_wrapper",collection:new a.Collections.Rows(themifyBuilder.builder_data)});a.Instances.Builder[0].render();a.toolbar.pageBreakModule.countModules();b("input#publish,input#save-post").one("click",function(c){b(".themify_builder").find("input[required]").removeAttr("required");
if(!g){var f=b(this);f.addClass("disabled");a.Utils.saveBuilder(function(){a.undoManager.reset();f.removeClass("disabled").trigger("click")});c.preventDefault()}});c=b('<a href="#" id="tb_switch_frontend_button" class="button tb_switch_frontend">'+themifyBuilder.i18n.switchToFrontendLabel+"</a>");var e=b(".themify-wp-editor-holder");e.length?c=e.find("a"):c.appendTo("#postdivrich #wp-content-media-buttons");c.on("click",function(a){a.preventDefault();b("#tb_switch_frontend").trigger("click")});b('input[name*="builder_switch_frontend"]').closest(".themify_field_row").remove();
a.Instances.Builder[a.builderIndex].$el.triggerHandler("tb_init");sessionStorage.getItem("focusBackendEditor")&&(a._backendBuilderFocus(),sessionStorage.removeItem("focusBackendEditor"));ThemifyStyles.init(ThemifyConstructor.data,ThemifyConstructor.breakpointsReverse,themifyBuilder.post_ID);themifyBuilder.is_gutenberg_editor||m()}};a._backendSwitchFrontend=function(c){b("#builder_switch_frontend_noncename").val("ok");g=!0;"publish"===b("#original_post_status").val()?themifyBuilder.is_gutenberg_editor?
(b(".editor-post-publish-button").length?b(".editor-post-publish-button").trigger("click"):b(".editor-post-publish-panel__toggle").trigger("click"),a.redirectFrontend=c,b("#tb_switch_frontend").trigger("click.frontend-btn")):b("#publish").trigger("click"):themifyBuilder.is_gutenberg_editor?(b(".editor-post-save-draft").trigger("click"),a.redirectFrontend=c):b("#save-post").trigger("click")};a._backendBuilderFocus=function(){b("#page-buildert").trigger("click");themifyBuilder.is_gutenberg_editor?a.Utils.scrollToDropped(a.toolbar.el):
a.Utils.scrollTo(a.toolbar.$el.offset().top-b("#wpadminbar").height())};b(function(){if(d[0].classList.contains("post-php")){var a=document.getElementById("post-lock-dialog");null===a||a.classList.contains("hidden")||Themify.LoadAsync(themifyBuilder.builder_url+"/js/themify-ticks.js",function(){d[0].classList.contains("tb_restriction")?TB_Ticks.init(themifyBuilder.ticks,window).show():TB_Ticks.init(themifyBuilder.ticks,window).ticks()},null,null,function(){return"undefined"!==typeof TB_Ticks})}if("function"===
typeof window.icl_copy_from_original){var e=window.icl_copy_from_original;window.icl_copy_from_original=function(a,c){e(a,c);b.ajax({url:ajaxurl,type:"POST",data:{action:"themify_builder_icl_copy_from_original",source_page_id:c,source_page_lang:a},success:function(a){"-1"!=a&&b("#page-builder .themify_builder.themify_builder_admin").empty().append(a).contents().unwrap()}})}}});b(window).one("load",function(){Themify.LoadAsync(themifyBuilder.builder_url+"/js/themify-constructor.js",function(){ThemifyConstructor.getForms(a.render)},
null,null,function(){return"undefined"!==typeof ThemifyConstructor})})})(jQuery,tb_app);
