'use strict';(function(c,v,r,w){function z(a,b){this.element=c(a);this.options=c.extend({},B,b);this.init()}var x="desktop",p,m=!1,y,q=!0,h=!1,e,d,t,u,l,k,n=c(v.document),f,B={append:!0,dropitems:null,elements:null,type:"",cancel:null,onDragStart:null,onDrag:null,onDragEnter:null,onDragLeave:null,onDragEnd:null,onDrop:null};z.prototype={init:function(){!1===h&&(l=c("<div/>",{id:"tb_placeholder_body",class:"tb_placeholder_helper"}),h=c("<div/>",{id:"tb_placeholder_iframe",class:"tb_placeholder_helper"}),
f=c("body"),f.prepend(h).on("themify_builder_change_mode",this.changeMode),t=w.toolbar.$el,u=c("#tb_fixed_bottom_scroll",n),c("body",n).append(l));this.element.off("mousedown.tb_visual").on("mousedown.tb_visual",this.mouseDown.bind(this))},elpos:{},is_enter:!1,first:null,size:{w:"",h:""},mouseDown:function(a){1!==a.which||a.target.classList.contains("tb_disable_sorting")?e=k=d=null:(a.preventDefault(),e=this.element,m=!1,this.first=null,q=!1,this.elpos=e.offset(),n.one("mousemove.tb_visual",this.firstMove.bind(this)).one("mouseup.tb_visual",
this.mouseUp.bind(this)))},firstMove:function(a){a.preventDefault();a.stopPropagation();if(e){c.isFunction(this.options.onDragBefore)&&this.options.onDragBefore.call(this,a,e);var b=e[0].outerHTML;h.removeClass("drop_animate").hide().html(b);l.removeClass("drop_animate").hide().html(b);b=c("body",n);b=b.add(c("body"));b.addClass("tb_drag_start tb_drag_"+this.options.type);this.setCurrentPlaceHolder(a);k.show();this.size.w=k.outerWidth()/2;this.size.h=k.outerHeight();c(r).on("mousemove.tb_visual",
this.mouseMove.bind(this)).on("mouseup.tb_visual",this.mouseUp.bind(this)).on("mouseenter.tb_visual",this.iframeEnter.bind(this)).on("mouseleave.tb_visual",this.iframeLeave.bind(this)).on("mouseenter.tb_visual",this.options.dropitems,this.mouseEnter.bind(this)).on("mouseleave.tb_visual",this.options.dropitems,this.mouseLeave.bind(this));n.on("mousemove.tb_visual",this.mouseMove.bind(this)).on("mouseup.tb_visual",this.mouseUp.bind(this));u.on("mouseenter.tb_visual",this.scroll.bind(this)).on("mouseleave.tb_visual",
this.scrollUp.bind(this));t.on("mouseenter.tb_visual",this.scroll.bind(this)).on("mouseleave.tb_visual",this.scrollUp.bind(this));this.mouseMove(a);c.isFunction(this.options.onDragStart)&&this.options.onDragStart.call(this,a,e)}},mouseMove:function(a){if(e&&k)if(m){var b=this,g=f.add(f.closest("html"));g.stop().animate({scrollTop:m},{duration:800,step:function(h){m?(h="down"===p?u.offset().top-y:t.offset().top+y,k.css("top",h)):g.stop();c.isFunction(b.options.onDrag)&&b.options.onDrag.call(b,a,e,
d)},complete:function(){b.checkScrollEnd()||(g.stop(),m=p=!1,b.setPlaceHolder(a))}})}else{if(this.is_enter&&this.options.elements&&d){b=this;for(var A=this.is_enter.find(this.options.dropitems+","+this.options.elements).get().reverse(),h=0,n=A.length;h<n;++h){var l=c(A[h]);if(b.CheckIntersect(a,l)&&(!b.options.cancel||0===l.closest(b.options.cancel).length)){b.removeAttr();d=l;break}}}this.setPlaceHolder(a)}},SetSide:function(a){var b=d[0].getBoundingClientRect();a=.5<(a.clientY-b.top)/(b.bottom-
b.top-20)?"bottom":"top";"top"===a&&d[0].parentNode===this.is_enter[0]&&0===d.index()&&(d=this.is_enter);d[0].dataset.pos!==a&&d.attr("data-pos",a)},setCurrentPlaceHolder:function(){k=q?h:l},setPlaceHolder:function(a){var b=void 0!==a.originalEvent?a.originalEvent:a;k.css({top:b.pageY-this.size.h-12,left:b.pageX-this.size.w});d&&this.SetSide(a);c.isFunction(this.options.onDrag)&&this.options.onDrag.call(this,a,e,d)},removeAttr:function(){for(var a=r.querySelectorAll("[data-pos]"),b=a.length-1;-1<
b;--b)a[b].removeAttribute("data-pos")},mouseUp:function(a){c(r).off(".tb_visual");n.off(".tb_visual");u.off(".tb_visual");t.off(".tb_visual");if(e&&k&&!a.isTrigger){a.stopPropagation();var b={},g=this;var f=e.clone();d?(b.top=d.offset().top,b.left=d.offset().left,"bottom"===d[0].dataset.pos&&(b.top+=d.outerHeight())):(b.top=this.elpos.top,b.left=this.elpos.left);this.is_enter=m=e=null;k.addClass("drop_animate").css(b).one(w.Utils.transitionPrefix(),function(a){var b=c("body",n);b=b.add("body");"row"===
g.options.type&&setTimeout(function(){w.toolbar.$el.find('.tb_zoom[data-zoom="100"]').trigger("click")},1E3);b.removeClass("tb_drag_start tb_drag_"+g.options.type);d&&d[0].dataset.pos&&(f.hide(),"bottom"===d[0].dataset.pos?g.options.append&&!d[0].classList.contains(g.options.elements.replace(".",""))?d.append(f):d.after(f):g.options.append&&!d[0].classList.contains(g.options.elements.replace(".",""))?d.prepend(f):d.before(f),g.removeAttr(),c.isFunction(g.options.onDrop)&&g.options.onDrop.call(g,a,
f,d),d=null);h.empty().removeAttr("style");l.empty().removeAttr("style")})}c.isFunction(this.options.onDragEnd)&&this.options.onDragEnd.call(this,a,f)},mouseEnter:function(a){e&&k&&(a.stopPropagation(),c(r).triggerHandler("mouseenter.tb_visual"),d=this.is_enter=c(a.currentTarget),this.removeAttr(),this.SetSide(a),c.isFunction(this.options.onDragEnter)&&this.options.onDragEnter.call(this,a,e,d))},mouseLeave:function(a){var b=c(a.currentTarget);if(e&&d&&!this.CheckIntersect(a,b)){var g=b.parent().closest(this.options.dropitems);
0<g.length&&this.CheckIntersect(a,g)?g.trigger("mouseenter.tb_visual"):(this.is_enter=null,this.removeAttr(),d=!1,c.isFunction(this.options.onDragLeave)&&this.options.onDragLeave.call(this,a,e,b))}},scroll:function(a){if(e&&k){var b=parseInt((f.height()-c(v).height())/5);a=c(a.currentTarget);"tb_fixed_bottom_scroll"===a.prop("id")?(m="+="+b+"px",p="down"):(m="-="+b+"px",p="up");0<b?y=a.height():m=!1}},checkScrollEnd:function(){var a=f.scrollTop();return"up"===p&&0!==a||"down"===p&&c(v).height()+a!==
f.height()},CheckIntersect:function(a,b){var c=b.offset();return a.pageX>=c.left&&a.pageX<=c.left+b.outerWidth()&&a.pageY>=c.top&&a.pageY<=c.top+b.outerHeight()},scrollUp:function(a){e&&k&&(m=p=!1,f.add(f.closest("html")).stop())},iframeEnter:function(a){e&&k&&(a.stopPropagation(),q=!0,l.hide(),h.show(),this.setCurrentPlaceHolder(),null===this.first&&(this.first=!0,this.mouseMove(a)))},iframeLeave:function(a){if(e&&k){a.stopPropagation();var b=this;setTimeout(function(){q=p?("desktop"===x||"block"===
h.css("display"))&&b.checkScrollEnd():!1;q||(h.hide(),l.show(),b.setCurrentPlaceHolder())},5)}},changeMode:function(a,b,d){x=d;f="desktop"===x?c("body"):c("body",n)}};c.fn.ThemifyDraggable=function(a){for(var b=this.length-1;-1<b;--b)c.data(this[b],"plugin_ThemifyDraggable")||c.data(this[b],"plugin_ThemifyDraggable",new z(this[b],a));return this}})(jQuery,window.top,document,tb_app);
