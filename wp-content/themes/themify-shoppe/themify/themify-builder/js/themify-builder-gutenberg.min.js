'use strict';(function(a,e,c,d){var f=c.createElement;a.builderUtils={stateInit:!1,number:0,tempHTML:null,vent:_.extend({},Backbone.Events),isRendered:function(){return document.getElementById("tb_toolbar")},saveHTML:function(b){this.isRendered()&&(this.tempHTML=document.getElementById("tb_canvas_block").innerHTML)},restoreHTML:function(b){if("undefined"!==typeof tb_app&&!_.isNull(this.tempHTML)&&!this.isRendered()&&document.getElementById("tb_canvas_block")&&(document.getElementById("tb_canvas_block").innerHTML=
this.tempHTML,!_.isUndefined(tb_app.Instances.Builder[0]))){b=document.getElementById("tb_row_wrapper").querySelectorAll("[data-cid]");b=Array.prototype.slice.call(b);for(var a=0,g=b.length;a<g;++a){var c=tb_app.Models.Registry.lookup(b[a].getAttribute("data-cid"));c&&c.trigger("change:view",b[a])}tb_app.toolbar.setElement(d("#tb_toolbar")).render();tb_app.toolbarCallback();tb_app.Instances.Builder[0].setElement(d("#tb_row_wrapper"));tb_app.Instances.Builder[0].init(!0)}},manageState:function(b){"undefined"===
typeof tb_app||this.stateInit||(this.stateInit=!0,tb_app.vent.on("dom:change",function(){tb_app.hasChanged&&b.setAttributes({data:a.builderUtils.number++})}),tb_app.vent.on("backend:switchfrontend",function(a){window.top.location.href=a}),document.getElementById("block-"+b.clientId).removeAttribute("tabIndex"))},saveBlock:function(){"undefined"!==typeof tb_app&&(this.onClicking?this.onClicking=!1:tb_app.hasChanged?tb_app.Utils.saveBuilder(this.goToFrontend):this.goToFrontend())},goToFrontend:function(){tb_app.redirectFrontend&&
tb_app.vent.trigger("backend:switchfrontend",tb_app.redirectFrontend)}};a.registerBlockType("themify-builder/canvas",{title:"Themify Builder",icon:"layout",category:"layout",useOnce:!0,edit:function(b){a.builderUtils.vent.trigger("edit",b);return f("div",{id:"tb_canvas_block"},"placeholder builder")},save:function(){return null}});e=_.debounce(function(b){a.builderUtils.saveHTML(b);a.builderUtils.restoreHTML(b);a.builderUtils.manageState(b)},800);c=_.debounce(function(){a.builderUtils.saveBlock()},
800);a.builderUtils.vent.on("edit",e);a.builderUtils.vent.on("save",c);d(function(){d("body").on("click",".editor-post-publish-button, .editor-post-save-draft",function(b){tb_app.hasChanged&&tb_app.Utils.saveBuilder(function(){a.builderUtils.onClicking=!0})}).off("click.frontend-btn","#tb_switch_frontend").on("click.frontend-btn","#tb_switch_frontend",function(){d(".editor-post-publish-button").on("DOMSubtreeModified",function(){this.classList.contains("is-busy")||d(".editor-post-saved-state").length||
(a.builderUtils.onClicking=!1,a.builderUtils.saveBlock())})})});d(document).ajaxComplete(function(b,d,c){"POST"===c.type&&void 0!==window.themifyBuilder&&themifyBuilder.post_ID&&-1!==c.url.indexOf("post.php?post="+themifyBuilder.post_ID+"&action=edit&classic-editor=1&meta_box=1")&&a.builderUtils.vent.trigger("save")})})(window.wp.blocks,window.wp.i18n,window.wp.element,jQuery);
